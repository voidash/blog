<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Hacking Casio Calculator | AshLogs</title>
<meta name=keywords content>
<meta name=description content="Let&rsquo;s hack the fx-991es calculator. Precisely we are exploiting the Buffer Overflow technique and doing some stuff {TODO}.Let me be clear that the calculator is a computer anyways. Buckle up as weare going to dive deep into some Computer Architecture.
Basics of fx-991es Don&rsquo;t get afraid of fancy words or fancy figures. After all they are the simple chain of concepts hidden behind some characters.
 Chip: nX-u8 Series chip. Manual Here Architecture: Super Harvard  CPU Resources and Programming Model : In Gajju We Trust General Architecture Most modern computer architecture follow the Vonn Neumann Architecture.">
<meta name=author content>
<link rel=canonical href=voidash.github.io/blog/posts/2023/hacking-casio-calculator/>
<link crossorigin=anonymous href=/voidash.github.io/blog/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/voidash.github.io/blog/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=voidash.github.io/blog/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=voidash.github.io/blog/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=voidash.github.io/blog/favicon-32x32.png>
<link rel=apple-touch-icon href=voidash.github.io/blog/apple-touch-icon.png>
<link rel=mask-icon href=voidash.github.io/blog/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[['\\[','\\]'],['$$','$$']],inlineMath:[['$','$']]}}</script>
<meta property="og:title" content="Hacking Casio Calculator">
<meta property="og:description" content="Let&rsquo;s hack the fx-991es calculator. Precisely we are exploiting the Buffer Overflow technique and doing some stuff {TODO}.Let me be clear that the calculator is a computer anyways. Buckle up as weare going to dive deep into some Computer Architecture.
Basics of fx-991es Don&rsquo;t get afraid of fancy words or fancy figures. After all they are the simple chain of concepts hidden behind some characters.
 Chip: nX-u8 Series chip. Manual Here Architecture: Super Harvard  CPU Resources and Programming Model : In Gajju We Trust General Architecture Most modern computer architecture follow the Vonn Neumann Architecture.">
<meta property="og:type" content="article">
<meta property="og:url" content="voidash.github.io/blog/posts/2023/hacking-casio-calculator/">
<meta property="og:image" content="voidash.github.io/blog/img/2023-12-29-15-38-14.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-12-29T15:15:25+05:45">
<meta property="article:modified_time" content="2023-12-29T15:15:25+05:45">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="voidash.github.io/blog/img/2023-12-29-15-38-14.png">
<meta name=twitter:title content="Hacking Casio Calculator">
<meta name=twitter:description content="Let&rsquo;s hack the fx-991es calculator. Precisely we are exploiting the Buffer Overflow technique and doing some stuff {TODO}.Let me be clear that the calculator is a computer anyways. Buckle up as weare going to dive deep into some Computer Architecture.
Basics of fx-991es Don&rsquo;t get afraid of fancy words or fancy figures. After all they are the simple chain of concepts hidden behind some characters.
 Chip: nX-u8 Series chip. Manual Here Architecture: Super Harvard  CPU Resources and Programming Model : In Gajju We Trust General Architecture Most modern computer architecture follow the Vonn Neumann Architecture.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"voidash.github.io/blog/posts/"},{"@type":"ListItem","position":3,"name":"Hacking Casio Calculator","item":"voidash.github.io/blog/posts/2023/hacking-casio-calculator/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hacking Casio Calculator","name":"Hacking Casio Calculator","description":"Let\u0026rsquo;s hack the fx-991es calculator. Precisely we are exploiting the Buffer Overflow technique and doing some stuff {TODO}.Let me be clear that the calculator is a computer anyways. Buckle up as weare going to dive deep into some Computer Architecture.\nBasics of fx-991es Don\u0026rsquo;t get afraid of fancy words or fancy figures. After all they are the simple chain of concepts hidden behind some characters.\n Chip: nX-u8 Series chip. Manual Here Architecture: Super Harvard  CPU Resources and Programming Model : In Gajju We Trust General Architecture Most modern computer architecture follow the Vonn Neumann Architecture.","keywords":[],"articleBody":"Let’s hack the fx-991es calculator. Precisely we are exploiting the Buffer Overflow technique and doing some stuff {TODO}.Let me be clear that the calculator is a computer anyways. Buckle up as weare going to dive deep into some Computer Architecture.\nBasics of fx-991es Don’t get afraid of fancy words or fancy figures. After all they are the simple chain of concepts hidden behind some characters.\n Chip: nX-u8 Series chip. Manual Here Architecture: Super Harvard  CPU Resources and Programming Model : In Gajju We Trust General Architecture Most modern computer architecture follow the Vonn Neumann Architecture. This means you have a single stick of RAM that contains both the code and data within it. But as mentioned earlier nx-u8 is harvard based architecture. This means it has seperate code and data space to work on. When reading the manual i figured out that, there are two address spaces:\n 512KB for code space 16MB for data space.  All the spaces are divided into physical segment of 64 kilobytes.\nRegisters Registers are the fastest piece of storage the CPU has access to. We care only about Program Counter and Link Registers.\nProgram counter holds the address for the next instruction to execute.\n Link Registers saves the contents of the program counter (PC) during subroutines/function calls and Interrupts. We only care about the first one called LR which is for Subroutine Call.\nMemory Model Revised Let me reinformthat this is harvard architecture, you have different space for code and different space for memory.\n 512KB of codespace and the code space word length is 16bits. 16MB of data space and the data memory word length is 8bits.  Word length is the array of bits that a single address specify.\n The Memory map we are concerned with is data memory which contains ROM and RAM. According to casio calc wikidot the memory map is as follows\n The notation followed is segment: hex_value . Segment is basically collection of many addresses\n   ROM : 0:0x0000h - 0:0x7FFFh The address starting from 0x000h till 0x7FFFh is the ROM. For the purpose of the tutorial, we don’t care about ROM\n  RAM : 0:0x8000h 0:0x8DFFh There are 3,583 addressable words. This means = 3583 x 8bits = 28664bits of RAM is available to us. But more importantly RAM is again divided into sub segments.\n  Input Area: [0x8154 .. 0x81B8] (total of 100 bytes) : Input Area stores whatever you type in calculator, from numbers to formulaes.\n  Cache Area(Buffer Area): [0x81B8 .. 0x821C] (total of 100 bytes) : Cache Area stores the previous buffer if you press AC so that you can go backgward with Replay Button, the big circle one on center near the screen\n    Let’s start Hacking Grab your Fx-991es calculator. Before we start hacking, let’s define the button convention as there are lots of buttons.\nAnything within [ ] means you have to exactly press the button. Example\n [CALC] [SHIFT] [logab]  Reaching the Null Terminator   Start by entering LineIO mode - [SHIFT] [MODE/SETUP] 2   Enter the following formula X = [SHIFT] [logab] X , 1 , 10 ^ 9   Start the calculation by entering [CALC] and = and stop it with [AC]   Press [LEFT] on a rounded button. Now replace the last parameter with 2 ([DEL] [DEL] [DEL] 2)   Start calculation with [CALC] =, you should get and error   now when you will press [LEFT] your cursor should be at the start of the expression, if you press anything you will see that nothing changes, that is because we reached the null terminator   Significance of Null terminator So, expression in the calculator is stored on the input buffer, once [AC] is pressed then the contents of input buffer is copied to cache buffer.\nThe copying is done till Null terminator. If there is no Null terminator then the Calculator will keep on copying until the end of RAM. This is the big vulnerability….. Normally it’s not a problem because the calculator ensures that the input buffer is always null terminated, so it will not overflow… But what if we could overwrite the Null terminator ?\n .stack-overall{ color:black; padding: 10px; background: white; } .border { border: 1px solid ; } .stack { padding: 10px; min-width: 200px; position: relative; border-right: 1px solid; } .stack  h4 { top: -33px; position: absolute; background: white; } .register{ padding: 7px; display: flex; justify-content: start; flex-direction: column; } .pc { } .top { display: flex; } .program-cluster { display: flex; } .program { margin: 10px; padding: 10px; position: relative; border: 1px solid red; } .p-title { position: absolute; top: -10px; background: white; } .controls { margin-top: 10px; } .c-d { border: 1px solid; } .btn { margin: 4px; background: #2d2d30; color: white; border: 1px solid black; }  stack Empty  Program Counter 0x8153  LR Register Empty  Autoplay Next Restart   P1 XX 0x8153: CALL P2 XX XX  Hello XX 0x81B2:CALL P2 XX XX   Description  let autoplay = document.querySelector('.autoplay'); let next = document.querySelector('.Next'); let restart = document.querySelector('.restart'); let stack = document.querySelector('.stack'); let pc = document.querySelector('.pc'); let lr = document.querySelector('.lr'); let programCluster = document.querySelector('.program-cluster'); let programs = [ [\"XX\", \"0x8153: CALL P2\", \"0x8154: NOP\"], [\"0x8bde: PUSH LR\", \"0x8bdf: CALL P3\", \"0x8be0: POP PC\"], [\"0x8cd1: PUSH LR\", \"XX\", \"0x8cd9: POP PC\"], ]; let line = []; function convertToHTML(pa, className) { let html = `\\n`; html += ` ${className.toUpperCase()}\\n`; for (let line of pa) { if (line === \"XX\") { html += ` ${line}\\n`; } else { html += ` ${line}\\n`; } } html += `\\n`; return html; } programCluster.innerHTML = ( convertToHTML(programs[0], \"p1\") + convertToHTML(programs[1], \"p2\") + convertToHTML(programs[2], \"p3\")); document.querySelectorAll('.ln').forEach((a) = console.log(a.innerHTML)); let index = 0; let stackArr = []; let stopAutoplay = false; let activated = false; let movement = [ \"0x8153: lr : Go to next procedure P2, This changes the pc to P2 and LR will contain return address of p1\", \"0x8bde: stack: Push the LR content to stack, LR contains address of P1\", \"0x8bdf: lr: Go to next procedure P3, LR will contain the return address of P2\", \"0x8cd1: stack: Push the LR content to stack, which is the P2 address\", \"0x8cd9: pop : Pop the stack value and store it in program counter\", \"0x8be0: pop : Pop the stack value and store it in program counter\", \"0x8be0: pop : Pop the stack value and store it in program counter\", \"0x8154: nop : Nop\", ]; function block(time) { return new Promise((resolve,reject) = { const timeout = setTimeout(() = { if (!stopAutoplay) { resolve(\"ok\"); }else { clearTimeout(timeout); reject(\"no\"); } },time); resolve.cancel = () = { clearTimeout(timeout); stopAutoplay = false; reject(new Error(\"Cancelled\")); } }); } function createCancellableBlock() { const ret = {}; ret.signal = new Promise((resolve, reject) = { ret.cancel = () = { reject(new Error(\"Promise was cancelled\")); } }); return ret; } autoplay.addEventListener(\"click\", async () = { next.disabled = true; if (!activated) { activated = true; for(let i = 0; i stack`; for (let st of stackArr) { console.log(whatToDo.match(/]+)/)[1]); stackString+= ` ${whatToDo.match(/]+)/)[1]}: 0x${nextAddress}`; } stack.innerHTML = stackString; } if(whatToDo.includes(\"pop\")) { stackArr.pop(); let stackString = `stack`; for (let st of stackArr) { stackString+= ` 0x${nextAddress}`; } stack.innerHTML = stackString; } let c = document.getElementsByClassName(`${address}`)[0] c.style.backgroundColor = \"yellow\"; setTimeout(() = {c.style.backgroundColor = \"red\"}, 3000); } function restartFn() { next.disabled = false; index = 0; stackArr = []; stack.innerHTML = `stackEmpty `; pc.innerHTML =`0x8153`; lr.innerHTML =`Empty`; activated = false; stopAutoplay = true; programCluster.innerHTML = ( convertToHTML(programs[0], \"p1\") + convertToHTML(programs[1], \"p2\") + convertToHTML(programs[2], \"p3\")); } restart.addEventListener(\"click\", restartFn); next.addEventListener(\"click\", () = { highlight(index); index++; })  The possibilities are endless….\n Remember that when ◄ is pressed then the contents of cache buffer is copied to input buffer.\n Full flow  So we know how to reach the null terminator, what else we could ask for.  Stack What is Return Oriented Programming ROP(Return Oriented Programming) btw is not related to the image above.\nBig Spoiler You can’t directly program it…. well, all these architecture shenanigans were there because we are ROPPING(Return Oriented Programming)\n  ","wordCount":"1307","inLanguage":"en","image":"voidash.github.io/blog/img/2023-12-29-15-38-14.png","datePublished":"2023-12-29T15:15:25+05:45","dateModified":"2023-12-29T15:15:25+05:45","mainEntityOfPage":{"@type":"WebPage","@id":"voidash.github.io/blog/posts/2023/hacking-casio-calculator/"},"publisher":{"@type":"Organization","name":"AshLogs","logo":{"@type":"ImageObject","url":"voidash.github.io/blog/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=voidash.github.io/blog accesskey=h title="AshLogs (Alt + H)">AshLogs</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=voidash.github.io/blog/voidash.github.io/blog/archives/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=voidash.github.io/blog/voidash.github.io/blog/joy-and-curiosity/ title="Joy and Curiosity">
<span>Joy and Curiosity</span>
</a>
</li>
<li>
<a href=voidash.github.io/blog/voidash.github.io/blog/random/ title=Random>
<span>Random</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Hacking Casio Calculator
</h1>
<div class=post-meta><span title="2023-12-29 15:15:25 +0545 +0545">December 29, 2023</span>
</div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="/voidash.github.io/blog/posts/2023/hacking-casio-calculator/img/2023-12-29-15-38-14_hu7e3e484d032d8b599589e1791742b113_205596_360x0_resize_box_3.png 360w ,/voidash.github.io/blog/posts/2023/hacking-casio-calculator/img/2023-12-29-15-38-14_hu7e3e484d032d8b599589e1791742b113_205596_480x0_resize_box_3.png 480w ,/voidash.github.io/blog/posts/2023/hacking-casio-calculator/img/2023-12-29-15-38-14_hu7e3e484d032d8b599589e1791742b113_205596_720x0_resize_box_3.png 720w ,/voidash.github.io/blog/posts/2023/hacking-casio-calculator/img/2023-12-29-15-38-14.png 750w" sizes="(min-width: 768px) 720px, 100vw" src=/voidash.github.io/blog/posts/2023/hacking-casio-calculator/img/2023-12-29-15-38-14.png alt width=750 height=387>
</figure>
<div class=post-content><p>Let&rsquo;s hack the fx-991es calculator. Precisely we are exploiting the Buffer Overflow technique and doing some stuff {TODO}.Let me be clear that the calculator is a computer anyways. Buckle up as weare going to dive deep into some Computer Architecture.</p>
<h3 id=basics-of-fx-991es>Basics of fx-991es<a hidden class=anchor aria-hidden=true href=#basics-of-fx-991es>#</a></h3>
<p>Don&rsquo;t get afraid of fancy words or fancy figures. After all they are the simple chain of concepts hidden behind some characters.</p>
<ul>
<li><strong>Chip</strong>: nX-u8 Series chip. <a href="./assets/nx-u8 manual.pdf">Manual Here</a></li>
<li><strong>Architecture</strong>: <a href=https://en.wikipedia.org/wiki/Super_Harvard_Architecture_Single-Chip_Computer>Super Harvard</a></li>
</ul>
<h3 id=cpu-resources-and-programming-model--in-gajju-we-trust>CPU Resources and Programming Model : In Gajju We Trust<a hidden class=anchor aria-hidden=true href=#cpu-resources-and-programming-model--in-gajju-we-trust>#</a></h3>
<h4 id=general-architecture>General Architecture<a hidden class=anchor aria-hidden=true href=#general-architecture>#</a></h4>
<p><img loading=lazy src=img/2023-12-29-16-03-18.png alt>
Most modern computer architecture follow the Vonn Neumann Architecture. This means you have a single stick of RAM that contains both the code and data within it. But as mentioned earlier nx-u8 is harvard based architecture. This means it has seperate code and data space to work on.
When reading the manual i figured out that, there are two address spaces:</p>
<ul>
<li>512KB for code space</li>
<li>16MB for data space.</li>
</ul>
<p>All the spaces are divided into physical segment of 64 kilobytes.</p>
<h4 id=registers>Registers<a hidden class=anchor aria-hidden=true href=#registers>#</a></h4>
<p>Registers are the fastest piece of storage the CPU has access to.
<img loading=lazy src=img/2023-12-29-16-04-30.png alt>
</p>
<p>We care only about <strong>Program Counter</strong> and <strong>Link Registers</strong>.</p>
<p><img loading=lazy src=img/2023-12-29-16-18-39.png alt>
<strong>Program counter</strong> holds the address for the next instruction to execute.</p>
<hr>
<p><img loading=lazy src=img/2023-12-29-16-17-07.png alt>
<strong>Link Registers</strong> saves the contents of the program counter (PC) during subroutines/function calls and Interrupts. We only care about the first one called <strong>LR</strong> which is for Subroutine Call.</p>
<h2 id=memory-model-revised>Memory Model Revised<a hidden class=anchor aria-hidden=true href=#memory-model-revised>#</a></h2>
<p>Let me reinformthat this is harvard architecture, you have different space for code and different space for memory.</p>
<ul>
<li>512KB of codespace and the code space word length is 16bits.</li>
<li>16MB of data space and the data memory word length is 8bits.</li>
</ul>
<p>Word length is the array of bits that a single address specify.</p>
<hr>
<p>The Memory map we are concerned with is data memory which contains ROM and RAM. According to <a href=https://casiocalc.wikidot.com/memory-map>casio calc wikidot</a> the memory map is as follows</p>
<blockquote>
<p>The notation followed is <code>segment: hex_value</code> . Segment is basically collection of many addresses</p>
</blockquote>
<ul>
<li>
<h3 id=rom--00x0000h---00x7fffh>ROM : <code>0:0x0000h - 0:0x7FFFh</code><a hidden class=anchor aria-hidden=true href=#rom--00x0000h---00x7fffh>#</a></h3>
<p>The address starting from 0x000h till 0x7FFFh is the ROM. For the purpose of the tutorial, we don&rsquo;t care about ROM</p>
</li>
<li>
<h3 id=ram--00x8000h-00x8dffh>RAM : <code>0:0x8000h 0:0x8DFFh</code><a hidden class=anchor aria-hidden=true href=#ram--00x8000h-00x8dffh>#</a></h3>
<p>There are 3,583 addressable words. This means = <code>3583 x 8bits = 28664bits</code> of RAM is available to us. But more importantly RAM is again divided into sub segments.</p>
<ul>
<li>
<p><strong>Input Area</strong>: <code>[0x8154 .. 0x81B8]</code> (total of 100 bytes) : Input Area stores whatever you type in calculator, from numbers to formulaes.</p>
</li>
<li>
<p><strong>Cache Area(Buffer Area)</strong>: <code>[0x81B8 .. 0x821C]</code> (total of 100 bytes) : Cache Area stores the previous buffer if you press AC so that you can go backgward with <code>Replay Button</code>, the big circle one on center near the screen</p>
</li>
</ul>
</li>
</ul>
<h1 id=lets-start-hacking>Let&rsquo;s start Hacking<a hidden class=anchor aria-hidden=true href=#lets-start-hacking>#</a></h1>
<p>Grab your Fx-991es calculator. Before we start hacking, let&rsquo;s define the <code>button convention</code> as there are lots of buttons.</p>
<p><img loading=lazy src=img/2024-01-08-16-50-42.png alt>
Anything within <code>[</code> <code>]</code> means you have to exactly press the button. Example</p>
<ul>
<li><code>[CALC]</code></li>
<li><code>[SHIFT]</code></li>
<li><code>[logab]</code></li>
</ul>
<h2 id=reaching-the-null-terminator>Reaching the Null Terminator<a hidden class=anchor aria-hidden=true href=#reaching-the-null-terminator>#</a></h2>
<ul>
<li>
<p>Start by entering LineIO mode - <code>[SHIFT] [MODE/SETUP] 2</code>
<img loading=lazy src=img/2024-01-08-17-10-52.png alt>
</p>
</li>
<li>
<p>Enter the following formula X = <code>[SHIFT] [logab] X , 1 , 10 ^ 9</code>
<img loading=lazy src=img/2024-01-08-17-24-22.png alt>
</p>
</li>
<li>
<p>Start the calculation by entering <code>[CALC]</code> and <code>=</code> and stop it with <code>[AC]</code>
<img loading=lazy src=img/2024-01-08-17-25-11.png alt>
</p>
</li>
<li>
<p>Press <code>[LEFT]</code> on a rounded button. Now replace the last parameter with 2 (<code>[DEL] [DEL] [DEL] 2</code>)
<img loading=lazy src=img/2024-01-08-17-27-02.png alt>
</p>
</li>
<li>
<p>Start calculation with <code>[CALC]</code> =, you should get and error
<img loading=lazy src=img/2024-01-08-17-27-40.png alt>
</p>
</li>
<li>
<p>now when you will press <code>[LEFT]</code> your cursor should be at the start of the expression, if you press anything you will see that nothing changes, that is because we reached the null terminator
<img loading=lazy src=img/2024-01-08-17-30-51.png alt>
</p>
</li>
</ul>
<h2 id=significance-of-null-terminator>Significance of Null terminator<a hidden class=anchor aria-hidden=true href=#significance-of-null-terminator>#</a></h2>
<p>So, expression in the calculator is stored on the input buffer, once <code>[AC]</code> is pressed then the contents of <code>input buffer</code> is copied to <code>cache buffer</code>.</p>
<p><img loading=lazy src=img/2024-01-08-17-48-09.png alt>
</p>
<p>The copying is done till <code>Null terminator</code>. If there is no <code>Null terminator</code> then the Calculator will keep on copying until the end of RAM. This is the big vulnerability&mldr;..
Normally it&rsquo;s not a problem because the calculator ensures that the input buffer is always null terminated, so it will not overflow&mldr; But what if we could overwrite the <code>Null</code> terminator ?</p>
<style>.stack-overall{color:#000;padding:10px;background:#fff}.border{border:1px solid}.stack{padding:10px;min-width:200px;position:relative;border-right:1px solid}.stack>h4{top:-33px;position:absolute;background:#fff}.register{padding:7px;display:flex;justify-content:start;flex-direction:column}.pc{}.top{display:flex}.program-cluster{display:flex}.program{margin:10px;padding:10px;position:relative;border:1px solid red}.p-title{position:absolute;top:-10px;background:#fff}.controls{margin-top:10px}.c-d{border:1px solid}.btn{margin:4px;background:#2d2d30;color:#fff;border:1px solid #000}</style>
<div class=stack-overall>
<div class="top border">
<div class=stack>
<h4>stack</h4>
<div class="content border">Empty</div>
</div>
<div class=register>
<span>Program Counter</span>
<div class="pc border">
0x8153
</div>
<span>LR Register</span>
<div class="lr border">
Empty
</div>
<button class="btn autoplay">Autoplay</button>
<button class="btn Next">Next</button>
<button class="btn restart">Restart</button>
</div>
</div>
<div class=program-cluster>
<div class="program p1">
<div class=p-title>P1</div>
<div class=some>XX</div>
<div class=l1>0x8153: CALL P2</div>
<div class=some>XX</div>
<div class=some>XX</div>
</div>
<div class="program p2">
<div class=p-title>Hello</div>
<div class=some>XX</div>
<div class=l1>0x81B2:CALL P2</div>
<div class=some>XX</div>
<div class=some>XX</div>
</div>
</div>
<div class=c-d>Description</div>
</div>
<script module>let autoplay=document.querySelector('.autoplay'),next=document.querySelector('.Next'),restart=document.querySelector('.restart'),stack=document.querySelector('.stack'),pc=document.querySelector('.pc'),lr=document.querySelector('.lr'),programCluster=document.querySelector('.program-cluster'),programs=[["XX","0x8153: CALL P2","0x8154: NOP"],["0x8bde: PUSH LR","0x8bdf: CALL P3","0x8be0: POP PC"],["0x8cd1: PUSH LR","XX","0x8cd9: POP PC"]],line=[];function convertToHTML(c,b){let a=`<div class="program ${b}">\n`;a+=`    <div class="p-title">${b.toUpperCase()}</div>\n`;for(let b of c)b==="XX"?a+=`    <div class="some">${b}</div>\n`:a+=`    <div class="ln ${b.substring(0,b.indexOf(':'))}">${b}</div>\n`;return a+=`</div>\n`,a}programCluster.innerHTML=convertToHTML(programs[0],"p1")+convertToHTML(programs[1],"p2")+convertToHTML(programs[2],"p3"),document.querySelectorAll('.ln').forEach(a=>console.log(a.innerHTML));let index=0,stackArr=[],stopAutoplay=!1,activated=!1,movement=["0x8153: lr : Go to next procedure P2, This changes the pc to P2 and LR will contain return address of p1","0x8bde: stack<P1 Address>: Push the LR content to stack, LR contains address of P1","0x8bdf: lr: Go to next procedure P3, LR will contain the return address of P2","0x8cd1: stack<P2 Address>: Push the LR content to stack, which is the P2 address","0x8cd9: pop : Pop the stack value and store it in program counter","0x8be0: pop : Pop the stack value and store it in program counter","0x8be0: pop : Pop the stack value and store it in program counter","0x8154: nop : Nop"];function block(a){return new Promise((b,c)=>{const d=setTimeout(()=>{stopAutoplay?(clearTimeout(d),c("no")):b("ok")},a);b.cancel=()=>{clearTimeout(d),stopAutoplay=!1,c(new Error("Cancelled"))}})}function createCancellableBlock(){const a={};return a.signal=new Promise((c,b)=>{a.cancel=()=>{b(new Error("Promise was cancelled"))}}),a}autoplay.addEventListener("click",async()=>{if(next.disabled=!0,!activated){activated=!0;for(let a=0;a<movement.length;a++)try{let b=await block(3e3);console.log(stopAutoplay),highlight(a)}catch{stopAutoplay=!1;break}activated=!1,next.disabled=!1}});function getRandomColor(){const a=Math.floor(Math.random()*256),b=Math.floor(Math.random()*256),c=Math.floor(Math.random()*256),d=255-a,e=255-b,f=255-c;return[`rgb(${a},${b},${c})`,`rgb(${d},${e}, ${f})`]}function highlight(g){let c=movement[g].split(":"),e=c[0],b=(Number.parseInt(e,16)+1).toString(16),a=c[1],f=c[2];if(document.querySelector('.c-d').innerHTML=f,pc.innerHTML=`0x`+b,a.includes("lr")){lr.innerHTML=pc.innerHTML;let a=getRandomColor();lr.style.backgroundColor=a[0],lr.style.color=a[1]}if(a.includes("stack")){stackArr.push(b);let c=`<h4>stack</h4>`;for(let d of stackArr)console.log(a.match(/<([^>]+)>/)[1]),c+=` <div class="content border">${a.match(/<([^>]+)>/)[1]}:  0x${b}</div>`;stack.innerHTML=c}if(a.includes("pop")){stackArr.pop();let a=`<h4>stack</h4>`;for(let c of stackArr)a+=` <div class="content border"> 0x${b}</div>`;stack.innerHTML=a}let d=document.getElementsByClassName(`${e}`)[0];d.style.backgroundColor="yellow",setTimeout(()=>{d.style.backgroundColor="red"},3e3)}function restartFn(){next.disabled=!1,index=0,stackArr=[],stack.innerHTML=`<h4>stack</h4><div class="content border"> Empty</div> `,pc.innerHTML=`0x8153`,lr.innerHTML=`Empty`,activated=!1,stopAutoplay=!0,programCluster.innerHTML=convertToHTML(programs[0],"p1")+convertToHTML(programs[1],"p2")+convertToHTML(programs[2],"p3")}restart.addEventListener("click",restartFn),next.addEventListener("click",()=>{highlight(index),index++})</script>
<p>The possibilities are endless&mldr;.</p>
<blockquote>
<p>Remember that when <code>◄</code> is pressed then the contents of <code>cache buffer</code> is copied to <code>input buffer</code>.</p>
</blockquote>
<h2 id=full-flow>Full flow<a hidden class=anchor aria-hidden=true href=#full-flow>#</a></h2>
<ul>
<li>So we know how to reach the null terminator, what else we could ask for.</li>
</ul>
<h2 id=stack>Stack<a hidden class=anchor aria-hidden=true href=#stack>#</a></h2>
<h2 id=what-is-return-oriented-programming>What is Return Oriented Programming<a hidden class=anchor aria-hidden=true href=#what-is-return-oriented-programming>#</a></h2>
<p><strong>ROP(Return Oriented Programming)</strong> btw is not related to the image above.</p>
<h3 id=big-spoiler>Big Spoiler<a hidden class=anchor aria-hidden=true href=#big-spoiler>#</a></h3>
<p>You can&rsquo;t directly program it&mldr;. well, all these architecture shenanigans were there because we are <strong>ROPPING(Return Oriented Programming)</strong></p>
<p><img loading=lazy src=img/2023-12-29-17-18-01.png alt>
</p>
<hr>
<hr>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2025 <a href=voidash.github.io/blog>AshLogs</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><style>.first{width:100%;display:flex;align-items:center;justify-content:center}.comments{margin:10px;width:60%}</style>
<div class=first>
<div class=comments>
<script src=https://giscus.app/client.js data-repo=voidash/blog data-repo-id=R_kgDOGcYJSw data-category=General data-category-id=DIC_kwDOGcYJS84CnRjF data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script>
</div>
</div>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>